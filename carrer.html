<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Job Application Form</title>
    <!-- <link rel="stylesheet" href="sts.css"> -->
    <link rel="stylesheet" href="./assets/css/carrers.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script>
        if (!('mediaDevices' in navigator) || !('getUserMedia' in navigator.mediaDevices)) {
            alert('Camera API is not available in your browser');
        }
    </script>

</head>

<body>
    <nav class="navbar">
        <div class="navbar-logo">
            <img src="./assets/imgs/logoc.png" alt="">
        </div>
        <ul class="navbar-links">
            <li><a href="/">Home</a></li>
            <li class="popiop"><a href="#">Apply for position</a></li>
            <!-- <li><a href="#">Contact Us</a></li> -->
        </ul>
        <div class="hamburger">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
    </nav>
    <div class="container_wrapper">

        <div class="side_art">
            <h2>C</h2>
            <h2>A</h2>
            <h2>V</h2>
            <h2>I</h2>
            <h2>D</h2>
            <h2>U</h2>
            <h2>S</h2>
        </div>
        <div class="form_wrapper">
            <h2> Application Form</h2>
            <div class="progressbar">
                <div class="progress" id="progress"></div>
                <div class="progress-step progress-step-active" data-title="Contact"></div>
                <div class="progress-step" data-title="Address"></div>
                <div class="progress-step" data-title="Picture"></div>
                <div class="progress-step" data-title="Languages & Qualification"></div>
                <div class="progress-step" data-title="Experience"></div>
            </div>
            <form id="jobForm" method="POST" enctype="multipart/form-data"
                action="https://formsubmit.co/oreoluwaa08@gmail.com">
                <input type="hidden" name="_subject" value="New Job Application - Cavidus Team">

                <input type="hidden" name="_next" value="https://YOUR-WEBSITE.COM/thank-you.html">
                <input type="hidden" name="_template" value="table">

                <div class="form-step active">
                    <div class="form-group">
                        <label for="surname" class="required">Surname:</label>
                        <input type="text" id="surname" name="surname" required>
                    </div>
                    <div class="form-group">
                        <label for="firstName" class="required">First Name:</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="otherNames">Other Names:</label>
                        <input type="text" id="otherNames" name="otherNames">
                    </div>
                    <div class="flex_d">
                        <div class="form-group col-3">
                            <label for="dob" class="required">Date of Birth:</label>
                            <input type="date" id="dob" name="dob" required>
                        </div>
                        <div class="form-group col-3">
                            <label for="phone" class="required">Phone Number:</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group col-3">
                            <label for="email" class="required">Email:</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="button" class="prev-step btn-prev">Previous</button>
                        <button type="button" class="next-step btn-next">Next</button>
                    </div>
                </div>

                <div class="form-step">
                    <div class="form-group">
                        <label for="address" class="required">Current Address:</label>
                        <textarea id="address" name="address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="position" class="required">Position Applied For:</label>
                        <select id="position" name="position" required>
                            <option value="">Select Position</option>
                            <option value="Waitress">Waitress</option>
                            <option value="Bar Man">Bar Man</option>
                            <option value="DJ">DJ</option>
                            <option value="Manager">Manager</option>
                        </select>
                    </div>
                    <div class="button-container">
                        <button type="button" class="prev-step btn-prev">Previous</button>
                        <button type="button" class="next-step btn-next">Next</button>
                    </div>
                </div>

                <div class="form-step ">
                    <div class="form-group pf">
                        <div class="potrait_view">
                            <div class="view" id="portrait-view"></div>
                            <div class="profile_valid">
                                <label for="portrait" class="required">Portrait Picture (Max 1MB):</label>
                            </div>
                        </div>
                        <div class="prt">
                            <div class="wrppf">
                                <input type="file" id="portrait" name="Portrait_Picture" accept="image/*" required>
                                <button type="button" id="camera-button">Take Picture</button>
                                <video id="camera-preview" autoplay></video>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="button" class="prev-step btn-prev">Previous</button>
                        <button type="button" class="next-step btn-next">Next</button>
                    </div>
                </div>

                <div class="form-step">
                    <div class="form-group lang_wrapper">
                        <label class="required">Languages:</label>
                        <div class="lang">
                            <div class="wrp"> <input type="checkbox" id="english" name="languages[]" value="English">
                                <label for="english">English</label>
                            </div>
                            <div class="wrp"> <input type="checkbox" id="yoruba" name="languages[]" value="Yoruba">
                                <label for="yoruba">Yoruba</label>
                            </div>
                            <div class="wrp"><input type="checkbox" id="igbo" name="languages[]" value="Igbo">
                                <label for="igbo">Igbo</label>
                            </div>
                            <div class="wrp"> <input type="checkbox" id="hausa" name="languages[]" value="Hausa">
                                <label for="hausa">Hausa</label>
                            </div>
                            <div class="wrp"><input type="checkbox" id="others" name="languages[]" value="Others"><label
                                    for="others">Others (Specify):</label></div>
                        </div>
                        <input type="text" id="others_specify" name="others_specify"
                            placeholder="Specify other languages">
                    </div>
                    <div class="form-group">
                        <label for="qualification" class="required">Highest Educational Qualification:</label>
                        <select id="qualification" name="qualification" required>
                            <option value="">Select Qualification</option>
                            <option value="High School">High School</option>
                            <option value="Diploma">Diploma</option>
                            <option value="Bachelor's Degree">Bachelor's Degree</option>
                            <option value="Master's Degree">Master's Degree</option>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                    <div class="button-container">
                        <button type="button" class="prev-step btn-prev">Previous</button>
                        <button type="button" class="next-step btn-next">Next</button>
                    </div>
                </div>

                <div class="form-step">
                    <div class="form-group">
                        <label for="experience">Skills and Experience (Max 500 characters):</label>
                        <textarea id="experience" name="experience" maxlength="500"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="cv">CV Attachment (Optional):</label>
                        <input type="file" id="cv" name="CV_Attachment" accept=".pdf,.doc,.docx">
                    </div>
                    <div class="form-group">
                        <label for="otherAttachment">Other Attachment (Optional):</label>
                        <input type="file" id="otherAttachment" name="Other_Attachment"
                            accept=".pdf,.doc,.docx, image/*">
                    </div>
                    <div class="button-container">
                        <button type="button" class="prev-step btn-prev">Previous</button>
                        <button type="submit">Submit</button>
                    </div>
                </div>

                <div class="form-step">
                    <p>Thank you for your submission.</p>
                </div>

                <div class="form-group">
                    <p id="error-message"></p>
                </div>
            </form>
        </div>

        <div class="thank-you-overlay" id="thank-you-overlay" style="display: none;">
            <div class="thank-you-content">
                <h2 class="thank-you-message">Thank You For Your Submission!</h2>
                <p>Thank you for your interest! We appreciate you taking the time to apply and will review your
                    qualifications.</p>
                <button class="return-home-button" id="return-home">Return to Home</button>
            </div>
        </div>
    </div>






    <script>
        const form = document.getElementById('jobForm');
        const progress = document.getElementById("progress");
        const steps = document.querySelectorAll('.form-step');
        const prevBtns = document.querySelectorAll(".btn-prev");
        const nextBtns = document.querySelectorAll(".btn-next");
        const progressSteps = document.querySelectorAll(".progress-step");
        const portraitInput = document.getElementById('portrait');
        const cameraButton = document.getElementById('camera-button');
        const cameraPreview = document.getElementById('camera-preview');
        const portraitView = document.getElementById('portrait-view');
        const errorMessage = document.getElementById('error-message');
        const navbarLinks = document.querySelector('.navbar-links');
        const hamburger = document.querySelector('.hamburger');
        const thankYouOverlay = document.getElementById('thank-you-overlay');
        const returnHomeButton = document.getElementById('return-home');


        let formStepsNum = 0;

        nextBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
                if (validateCurrentStep()) {
                    formStepsNum++;
                    updateFormSteps();
                    updateProgressbar();
                }
            });
        });

        prevBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
                formStepsNum--;
                updateFormSteps();
                updateProgressbar();
            });
        });

        function updateFormSteps() {
            steps.forEach((formStep) => {
                formStep.classList.contains("active") &&
                    formStep.classList.remove("active");
            });

            steps[formStepsNum].classList.add("active");
        }

        function updateProgressbar() {
            progressSteps.forEach((progressStep, idx) => {
                if (idx < formStepsNum + 1) {
                    progressStep.classList.add("progress-step-active");
                } else {
                    progressStep.classList.remove("progress-step-active");
                }
            });

            const progressActive = document.querySelectorAll(".progress-step-active");

            progress.style.width =
                ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + "%";
        }


        function validateCurrentStep() {
            if (formStepsNum === 0) {
                const surname = document.getElementById('surname').value;
                const firstName = document.getElementById('firstName').value;
                const dob = document.getElementById('dob').value;
                const phone = document.getElementById('phone').value;
                const email = document.getElementById('email').value;
                if (!surname || !firstName || !dob || !phone || !email) {
                    errorMessage.textContent = "Please enter your Surname, First Name, Date of Birth, Phone Number and Email.";
                    return false;
                }
            }
            if (formStepsNum === 1) {
                const address = document.getElementById('address').value;
                const position = document.getElementById('position').value;
                if (!address || !position) {
                    errorMessage.textContent = "Please enter your Address and Position.";
                    return false;
                }
            }
            if (formStepsNum === 2) {
                if (!portraitInput.files || portraitInput.files.length === 0) {
                    errorMessage.textContent = "Please upload a portrait picture.";
                    return false;
                } else if (portraitInput.files[0].size > 3000000) {
                    errorMessage.textContent = "Portrait picture must be 3MB or less.";
                    return false;
                }
            }
            // New code for Step 3 (formStepsNum === 3):
            if (formStepsNum === 3) {
                // Check if at least one checkbox with name="languages[]" is checked
                const language = document.querySelector('input[name="languages[]"]:checked');
                const qualification = document.getElementById('qualification').value;

                if (!language || !qualification) {
                    errorMessage.textContent = "Please select at least one Language and a Qualification.";
                    return false;
                }
            }
            errorMessage.textContent = "";
            return true;
        }

        // Global variable to hold the stream so we can stop it later
        let mediaStream = null;

        // Hide the video preview and show the "Take Picture" button initially
        cameraPreview.style.display = 'none';
        cameraButton.addEventListener('click', async function () {
            // Stop any existing stream
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
            }

            try {
                // 1. Start the camera stream
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                mediaStream = stream; // Store the stream globally
                cameraPreview.srcObject = stream;
                cameraPreview.style.display = 'block';

                // 2. Change 'Take Picture' button to 'Capture'
                cameraButton.textContent = 'Capture';
                cameraButton.removeEventListener('click', arguments.callee); // Remove current listener
                cameraButton.addEventListener('click', capturePicture); // Add capture listener

            } catch (err) {
                console.error('Error accessing camera:', err);
                errorMessage.textContent = 'Could not access camera. Please try manual upload.';
            }
        });

        async function capturePicture() {
            if (!mediaStream) return;

            // 1. Draw video frame to canvas
            const canvas = document.createElement('canvas');
            canvas.width = cameraPreview.videoWidth;
            canvas.height = cameraPreview.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(cameraPreview, 0, 0, canvas.width, canvas.height);

            // 2. Convert canvas to Blob (Image data)
            canvas.toBlob((blob) => {
                // 3. Create a File object from the blob
                // This is the crucial step to sync captured image with the file input
                const capturedFile = new File([blob], "captured_portrait.jpeg", {
                    type: "image/jpeg",
                    lastModified: Date.now()
                });

                // 4. Create a DataTransfer object and assign the File to the input
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(capturedFile);
                portraitInput.files = dataTransfer.files;

                // 5. Display the captured image preview
                const reader = new FileReader();
                reader.onload = function (e) {
                    displayImage(e.target.result);
                };
                reader.readAsDataURL(capturedFile);

                // 6. Stop the camera and reset the button/display
                mediaStream.getTracks().forEach(track => track.stop());
                cameraPreview.style.display = 'none';
                cameraButton.textContent = 'Take Picture';

                // Reset the event listener to the initial state (start camera)
                cameraButton.removeEventListener('click', capturePicture);
                cameraButton.addEventListener('click', cameraButton.listeners[0]); // Re-attach the initial listener

            }, 'image/jpeg', 0.9);
        }

        // Ensure the initial file upload works correctly too
        portraitInput.addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    displayImage(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        function displayImage(base64String) {
            const img = document.createElement('img');
            img.src = base64String;
            portraitView.innerHTML = '';
            portraitView.appendChild(img);
        }

        // ðŸ’¥ KEY CHANGE: Modified the submit listener ðŸ’¥
        form.addEventListener('submit', function (event) {
            // Only validate the final step (Step 4: Experience) before letting the form submit
            if (formStepsNum !== 4) {
                // If the user somehow hits submit before the last step, validate and move forward if possible.
                event.preventDefault();
                if (validateCurrentStep()) {
                    formStepsNum++;
                    updateFormSteps();
                    updateProgressbar();
                }
            } else {
                // This is the final step. Run the final validation.
                if (!validateCurrentStep()) {
                    event.preventDefault(); // Stop submission if validation fails
                }
                // If validation passes, the form is allowed to submit to FormSubmit.co
                // The 'thank-you-overlay' is no longer needed here as FormSubmit redirects.
            }
        });
        returnHomeButton.addEventListener('click', () => {
            thankYouOverlay.style.display = 'none';
        });

        updateFormSteps();
        updateProgressbar();

        // Hamburger menu functionality
        hamburger.addEventListener('click', () => {
            navbarLinks.classList.toggle('active');
            hamburger.classList.toggle('active');
        });
    </script>
</body>

</html>